<?php
/*
 * Created on Aug 7, 2013
 *
 * To change the template for this generated file go to
 * Window - Preferences - PHPeclipse - PHP - Code Templates
 */

function pickem_init() {
	
}

function pickem_menu() {
	return array(
		'admin/config/pickem' => array(
			'title' => 'Pickem Administration',
			'description' => 'Adjust settings for your Pickem environment',
			'position' => 'right',
			'weight' => -5,
			'page callback' => 'system_admin_menu_block_page',
			'access arguments' => array('administer pickem settings'),
			'access callback' => TRUE,
			'file' => 'system.admin.inc',
			'file path' => drupal_get_path('module', 'system'),
		),
		'admin/config/pickem/games' => array(
			'title' => 'Games Management',
			'page callback' => 'drupal_get_form',
			'page arguments' => array('pickem_games_admin'),
			'access arguments' => array('administer pickem settings', 'administer pickem games'),
			'access callback' => TRUE,
			'type' => MENU_NORMAL_ITEM,   
		),
	);
}

function pickem_games_admin($form, &$form_state, $week) {
	$query = db_select('slate', 's');
	$query->join('game', 'g', 's.gid = g.gid');
	$query->join('school', 'host', 'g.host_school_name = host.machine_name');
	$query->join('school', 'visiting', 'g.visiting_school_name = visiting.machine_name');
	$query->fields('g', array('host_school_name', 'visiting_school_name', 'game_date'));
	$query->fields('host', array('title'));
	$query->fields('visiting', array('title'));
	$query->orderBy('game_date');
	$query->condition('slate_id', $week);
	$result = $query->execute();
	while($record = $result->fetchObject()) {
		kpr($record);
	}

	return $form;
}

function pickem_permission() {
	return array(
		'administer pickem settings' => array(
			'title' => t('Administer Pickem Setttings'),
			'description' => t('Perform administration tasks on Pickem settings'),
		),
		'administer pickem games' => array(
			'title' => t('Administer Pickem Games'),
			'description' => t('Perform administration tasks on Pickem games'),
		),
	);
}
 
function pickem_block_info($delta='') {
	return array();
}

